# Инструкция по настройке интеграции форм 1С-Битрикс с amoCRM

## Структура файлов

```
/local/
  /php_interface/
    /classes/
      FormAmoCRMHandler.php  ← Класс обработчика
    init.php                 ← Добавить код регистрации
  /logs/
    amocrm.log              ← Логи (создастся автоматически)
```

## Шаг 1: Разместите файлы

1. Создайте папку `/local/php_interface/classes/` (если её нет)
2. Скопируйте файл `FormAmoCRMHandler.php` в эту папку
3. Откройте ваш файл `/local/php_interface/init.php`
4. Добавьте в конец файла код из `init_addition.php`

## Шаг 2: Получите Access Token для amoCRM

1. Зайдите в amoCRM: https://31491690.amocrm.ru
2. Перейдите в **Настройки** → **Интеграции** → **API**
3. Создайте новую интеграцию
4. Получите **Access Token** (долгосрочный токен доступа)

## Шаг 3: Настройте класс

Откройте файл `FormAmoCRMHandler.php` и замените:

```php
const AMOCRM_ACCESS_TOKEN = 'ВАШ_ACCESS_TOKEN_ЗДЕСЬ'; // Вставьте полученный токен
```

Ваши данные уже подставлены:
- Аккаунт: **31491690** ✓
- ID ответственного: **3673005** ✓
- ID воронки: **10131606** ✓
- ID этапа: **80274978** ✓

## Шаг 4: Как работает обработка полей

Код **автоматически определяет** типы полей по их символьным кодам:

- **Имя**: поля содержащие `NAME`, `IMY`, `IMYA` → создается контакт с именем
- **Телефон**: поля содержащие `PHONE`, `TEL`, `TELEFON` → добавляется в контакт
- **Email**: поля содержащие `EMAIL`, `MAIL`, `E-MAIL` → добавляется в контакт
- **Все остальные поля** → попадают в комментарий к лиду

Настройка полей не требуется! Код обработает любую форму автоматически.

## Шаг 5: Проверьте работу

1. Отправьте тестовую форму на сайте
2. Проверьте появление лида в amoCRM: https://31491690.amocrm.ru/leads/
3. Проверьте логи (если есть ошибки): `/local/logs/amocrm.log`

## Что делает код:

✅ Перехватывает отправку **ВСЕХ форм** через `addEventHandler`
✅ Автоматически определяет имя, телефон и email по названиям полей
✅ Создает контакт в amoCRM с найденными данными
✅ Создает лид в вашей воронке (ID: 10131606) на нужном этапе (ID: 80274978)
✅ Назначает ответственного (ID: 3673005)
✅ Все остальные поля формы добавляет в примечание
✅ Логирует все действия для отладки
